<project name="auth" default="deploy" basedir=".">
    
	<target name="-init">
    	<available property="props" file="build.properties"/>
    	<fail unless="props">
    		Please copy build.properties.template to build.properties and update the settings.
    	</fail>
    	<loadproperties srcfile="build.properties"/>
        <property name="app" value="auth"/>

        <mkdir dir="deploy/${app}"/> 
        <mkdir dir="deploy/${app}/classes"/>
	</target>
	
	<target name="-base" depends="-init">
    	<!-- Copy the classpath from the base application -->
        <copy todir="deploy/${app}/classes">
            <fileset dir="${install.dir}/app - auth/resources">
            	<exclude name="linked-root/**"/>
            	<exclude name="layout-pages/**"/>
            </fileset>            
            <fileset dir="${install.dir}/app - auth/src-gen/classes"/>
        	<fileset dir="${install.dir}/app - auth/src-gen" includes="com/**/*.class"/>
        </copy>

    	<!-- Usecases/I18N/services from the base application. -->
        <copy todir="deploy/${app}/">
        	<fileset dir="${install.dir}/app - auth/resources" includes="config.properties"/>
        	<fileset dir="${install.dir}/app - auth/resources" includes="services/*.xml"/>
            <fileset dir="${install.dir}/app - auth/src-gen"  includes="internationalization/*.properties"/>
        	<fileset dir="${install.dir}/app - auth/src-gen" includes="auth.xml"/>
        	<fileset dir="${install.dir}/app - auth/src-gen" includes = "usecases/*.xml"/>
        </copy>

    	<!-- Copy the linked-root and layout-pages from the base application. -->
        <copy todir="deploy/${app}">
            <fileset dir="${install.dir}/app - auth/resources" includes="linked-root/**/*.*"/>
        	<fileset dir="${install.dir}/app - auth/resources" includes="layout-pages/**/*.*"/>
        </copy>

    	<!-- Copy configuration for jetty -->
        <copy todir="deploy">
        	<fileset dir="${install.dir}/app - auth/deploy">
        		<include name="jndi.xml"/>
        		<include name="license"/>
        	</fileset>
        </copy>    	

	</target>
	
	<!-- Copy the 1FFC files common across all applications. -->
	<target name="-common" depends="-init, -base">

		<copy todir="deploy/${app}" overwrite="true">
            <fileset dir="../1ffc - common" includes="linked-root/**/*"/>            
			<fileset dir="../1ffc - common" includes="layout-pages/**/*"/>
        </copy>

    	<!-- Duplicate the common linked-root for the b2c and admin login flows -->
    	<copy todir="deploy/${app}/linked-root/b2c" overwrite="true">  
    		<fileset dir="../1ffc - common/linked-root" includes="**/*.*"/>
    	</copy>    	
    	<copy todir="deploy/${app}/linked-root/csr" overwrite="true">
    		<fileset dir="../1ffc - common/linked-root" includes="**/*.*"/>
    	</copy>

	</target>
	
    <target name="deploy" depends="-init, -base, -common">
		<copy todir="deploy/${app}" overwrite="true">
			<fileset dir="." includes="layout-pages/**/*"/>
        </copy>
    </target>
</project> 
